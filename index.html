<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Accounting Ledger</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid #ccc; }
        th, td { padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        form { margin-top: 20px; }
        label { display: block; margin: 5px 0 2px; }
        input, select, button { padding: 5px; margin-bottom: 10px; }
        .filter-buttons button { margin-right: 10px; }
    </style>
</head>
<body>
<h1>Accounting Ledger</h1>

<!-- Filter Buttons -->
<div class="filter-buttons">
    <button onclick="loadAll()">All Transactions</button>
    <button onclick="loadDeposits()">Deposits</button>
    <button onclick="loadPayments()">Payments</button>
</div>

<!-- Search by Vendor -->
<div>
    <label for="vendorSearch">Search by Vendor:</label>
    <input type="text" id="vendorSearch" placeholder="Vendor name">
    <button onclick="searchVendor()">Search</button>
</div>

<!-- Transactions Table -->
<table id="transactionsTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Time</th>
        <th>Description</th>
        <th>Vendor</th>
        <th>Amount</th>
    </tr>
    </thead>
    <tbody>
    <!-- Transactions will be inserted here dynamically -->
    </tbody>
</table>

<!-- Add Deposit Form -->
<form id="depositForm" onsubmit="addDeposit(event)">
    <h2>Add Deposit</h2>
    <label>Vendor:</label>
    <input type="text" id="depositVendor" required>
    <label>Description:</label>
    <input type="text" id="depositDescription" required>
    <label>Amount:</label>
    <input type="number" id="depositAmount" step="0.01" required>
    <button type="submit">Add Deposit</button>
</form>

<!-- Add Payment Form -->
<form id="paymentForm" onsubmit="addPayment(event)">
    <h2>Add Payment</h2>
    <label>Vendor:</label>
    <input type="text" id="paymentVendor" required>
    <label>Description:</label>
    <input type="text" id="paymentDescription" required>
    <label>Amount:</label>
    <input type="number" id="paymentAmount" step="0.01" required>
    <button type="submit">Add Payment</button>
</form>

<script>
    const API_BASE = "http://localhost:8080/api/transactions";

    // Helper to render transactions in table
    function renderTransactions(transactions) {
        const tbody = document.querySelector("#transactionsTable tbody");
        tbody.innerHTML = ""; // clear existing rows
        transactions.forEach(t => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${t.id}</td>
                <td>${t.transactionDate}</td>
                <td>${t.transactionTime}</td>
                <td>${t.description}</td>
                <td>${t.vendor}</td>
                <td>${t.amount}</td>
            `;
            tbody.appendChild(row);
        });
    }

    // Load all transactions
    async function loadAll() {
        const res = await fetch(`${API_BASE}/all`);
        const data = await res.json();
        renderTransactions(data);
    }

    // Load deposits
    async function loadDeposits() {
        const res = await fetch(`${API_BASE}/deposits`);
        const data = await res.json();
        renderTransactions(data);
    }

    // Load payments
    async function loadPayments() {
        const res = await fetch(`${API_BASE}/payments`);
        const data = await res.json();
        renderTransactions(data);
    }

    // Search by vendor
    async function searchVendor() {
        const vendor = document.getElementById("vendorSearch").value;
        if (!vendor) return alert("Enter a vendor to search.");
        const res = await fetch(`${API_BASE}/search?vendor=${encodeURIComponent(vendor)}`);
        const data = await res.json();
        renderTransactions(data);
    }

    // Add deposit
    async function addDeposit(event) {
        event.preventDefault();
        const vendor = document.getElementById("depositVendor").value;
        const description = document.getElementById("depositDescription").value;
        const amount = parseFloat(document.getElementById("depositAmount").value);

        await fetch(`${API_BASE}/deposit?vendor=${encodeURIComponent(vendor)}&description=${encodeURIComponent(description)}&amount=${amount}`, {
            method: "POST"
        });

        // Reset form and reload table
        document.getElementById("depositForm").reset();
        loadAll();
    }

    // Add payment
    async function addPayment(event) {
        event.preventDefault();
        const vendor = document.getElementById("paymentVendor").value;
        const description = document.getElementById("paymentDescription").value;
        const amount = parseFloat(document.getElementById("paymentAmount").value);

        await fetch(`${API_BASE}/payment?vendor=${encodeURIComponent(vendor)}&description=${encodeURIComponent(description)}&amount=${amount}`, {
            method: "POST"
        });

        // Reset form and reload table
        document.getElementById("paymentForm").reset();
        loadAll();
    }

    // Load all transactions on page load
    loadAll();
</script>
</body>
</html>
